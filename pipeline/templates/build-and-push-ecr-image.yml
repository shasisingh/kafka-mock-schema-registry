parameters:
  - name: repositoryName
    type: string

steps:
  - task: Docker@2
    displayName: 'Docker build ${{parameters.repositoryName}}'
    inputs:
      command: 'build'
      Dockerfile: 'Dockerfile'
      arguments: '-t 189545432913.dkr.ecr.eu-west-1.amazonaws.com/${{parameters.repositoryName}}'
      tags: |
        $(Build.BuildId)
        latest

  - task: ECRPushImage@1
    displayName: 'Docker push ${{parameters.repositoryName}}'
    inputs:
      awsCredentials: 'AWS-Account-eudev-rabodirectconnect-1'
      regionName: 'eu-west-1'
      imageSource: 'imagename'
      sourceImageName: '189545432913.dkr.ecr.eu-west-1.amazonaws.com/${{parameters.repositoryName}}'
      sourceImageTag: 'latest'
      repositoryName: '${{parameters.repositoryName}}'
      pushTag: 'latest'
